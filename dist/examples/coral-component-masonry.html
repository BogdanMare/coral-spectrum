<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coral.Masonry</title>

    <script>window.addEventListener("message", function(e) {!document.head.querySelector('svg') && document.head.insertAdjacentHTML("beforeend", e.data)});</script>
    <script>document.addEventListener('click', function(event) {if (event.target.nodeName === 'A' || event.matchedTarget && event.matchedTarget.nodeName === 'A') {event.preventDefault();}});</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const markup = document.body.querySelectorAll('.markup');
        for (var i = 0; i < markup.length; i++) {
          const code = markup[i].innerHTML;
          const id = 'markup-code-' + i;
          markup[i].insertAdjacentHTML('afterend',
            '<div style="margin:10px 0">' +
            '<a onclick="this.nextElementSibling.hidden = !this.nextElementSibling.hidden" class="coral-Link" href="#">Toggle markup</a>' +
            '<pre hidden>' +
            '<code id="'+ id +'" class="html">' +
            '</code>' +
            '</pre>' +
            '</div>');
          document.getElementById(id).textContent = code;
        }
        window.hljs.initHighlightingOnLoad();
      });
    </script>

    <link rel="stylesheet" href="../css/coral.css">
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const script = document.createElement('script');
        script.src = '../js/coral.js';
        document.head.appendChild(script);
      });
    </script>
  </head>

  <body class="coral--light">

    <div style="position:fixed;top:15px;right:15px;">
      <a href="#" class="coral-Link" onclick="document.body.className='coral--light'">Light</a> |
      <a href="#" class="coral-Link" onclick="document.body.className='coral--lightest'">Lightest</a> |
      <a href="#" class="coral-Link" onclick="document.body.className='coral--dark'">Dark</a> |
      <a href="#" class="coral-Link" onclick="document.body.className='coral--darkest'">Darkest</a>
    </div>

    <section class="u-coral-margin">
      <div class="markup">
        <style>
          coral-masonry {
            border: 1px dashed #ccc;
            border-radius: 4px;
            margin: 1rem;
            padding: 0.5rem;
          }

          coral-masonry.is-complete > coral-masonry-item.is-beforeInserting:first-child {
            /* Set top to padding height for a straight transition */
            transform: translate(-200%, 0.5rem);
          }

          coral-masonry-item {
            margin: 0.5rem;
          }

          coral-masonry article {
            padding: 0.5rem;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
          }

          coral-masonry img {
            max-width: 100%;
          }

          [coral-masonry-draghandle]:before {
            content: "â ¿";
          }

        </style>

        <label>
          Selection mode
          <select name="selection">
            <option>none</option>
            <option>single</option>
            <option>multiple</option>
          </select>
        </label>
        <br>
        <label>
          Layout
          <select name="layout">
            <option>fixed-centered</option>
            <option>fixed-spread</option>
            <option>variable</option>
            <option>dashboard</option>
          </select>
        </label>
        <br>
        <label>
          Column width
          <input name="columnWidth">
        </label>
        <br>
        <button class="prepend" data-count="1">prepend 1</button>
        <button class="prepend" data-count="10">prepend 10</button>
        <button class="append" data-count="1">append 1</button>
        <button class="append" data-count="10">append 10</button>
        <button class="append" data-count="100">append 100</button>
        <label>
          Image
          <input type="checkbox" name="image">
        </label>
        (double click on item to remove it)

        <coral-masonry orderable id="masonry" layout="fixed-centered" columnwidth="250" orderable>
          <coral-masonry-item class="coral-Well">
            <article>
              <span coral-masonry-draghandle></span>
              With image
              <img src="http://via.placeholder.com/600x300">
            </article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>
              <span coral-masonry-draghandle></span>
              card
              <br>card
            </article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well" colspan="2">
            <article>
              <span coral-masonry-draghandle></span>
              card
              <br>card
              <br>card
            </article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>
              <span coral-masonry-draghandle></span>
              card
              <br>card
              <br>card
              <br>card
            </article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well" colspan="2">
            <article>card
              <br>card
              <br>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>card
              <br>card
              <br>card
              <br>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well" colspan="2">
            <article>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>card
              <br>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well" colspan="2">
            <article>card
              <br>card
              <br>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
          <coral-masonry-item class="coral-Well">
            <article>card
              <br>card
              <br>card
              <br>card
              <br>card
              <br>card</article>
          </coral-masonry-item>
        </coral-masonry>
        <script>
          window.addEventListener('load', function() {
            const masonry = document.getElementById('masonry');

            const layoutSelector = document.querySelector('[name=layout]');
            layoutSelector.value = masonry.getAttribute('layout');
            layoutSelector.addEventListener('change', function() {
              masonry.setAttribute('layout', this.value);
            });

            const selectionSelector = document.querySelector('[name=selection]');
            selectionSelector.value = masonry.getAttribute('selectionmode');
            selectionSelector.addEventListener('change', function() {
              masonry.setAttribute('selectionmode', this.value);
            });

            const columnWidthSelector = document.querySelector('[name=columnWidth]');
            columnWidthSelector.value = masonry.getAttribute('columnwidth');
            columnWidthSelector.addEventListener('input', function() {
              masonry.setAttribute('columnwidth', this.value);
            });

            masonry.on('dblclick', 'coral-masonry-item', function(event) {
              event.matchedTarget.remove();
            });

            document.addEventListener('click', function(event) {
              const prepend = event.target.matches('.prepend');
              if (prepend) {
                var count = prepend.dataset.count;
                for (var i = 0; i < count; i++) {
                  masonry.items.add(createItem(), masonry.items.first());
                }
              }
            });

            document.addEventListener('click', function(event) {
              const append = event.target.matches('.append');
              if (append) {
                var startTime = Date.now();
                var count = append.dataset.count;
                for (var i = 0; i < count; i++) {
                  masonry.items.add(createItem());
                }
                window.requestAnimationFrame(function() {
                  console.log('Appending time:', Date.now() - startTime);
                });
              }
            });

            function createItem() {
              var image = document.querySelector('[name=image]').checked;
              return image ? createImageItem() : createTextItem();
            }

            function randomSize() {
              return (2 + Math.round(Math.random() * 4)) * 100;
            }

            function createImageItem() {
              var width = randomSize();
              var height = randomSize();
              var url = 'http://via.placeholder.com/' + width + 'x' + height;

              var item = document.createElement('coral-masonry-item');
              item.classList.add('coral-Well');
              item.content.innerHTML = '<img src="' + url + '" style="width: ' + (width / 2) + 'px; height: ' + (height / 2) + 'px;">';

              return item;
            }

            function createTextItem() {
              var rows = 1 + Math.round(Math.random() * 6);
              var html = new Array(rows + 1).join('card<br>').slice(0, -4);

              var item = document.createElement('coral-masonry-item');
              item.classList.add('coral-Well');
              item.content.innerHTML = '<article>' + html + '</article>';

              return item;
            }
          });
        </script>
      </div>
    </section>

  </body>

</html>
